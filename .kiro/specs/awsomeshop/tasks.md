# Implementation Plan: AWSomeShop 员工福利电商平台

## 概述

本实现计划将 AWSomeShop 系统分解为可执行的编码任务，采用增量开发方式，从基础设施搭建开始，逐步实现核心业务功能。每个任务都与需求文档中的具体需求关联。

## 任务列表

### 阶段 1: 项目基础设施搭建

- [x] 1. 搭建后端项目结构
  - [x] 1.1 创建 .NET 8 Web API 项目结构
    - 创建解决方案和项目目录结构
    - 配置 Controllers、Services、Repositories、Models 分层
    - 设置依赖注入容器
    - _需求: 架构设计_
  - [x] 1.2 配置 Entity Framework Core 和 MySQL 连接
    - 安装 EF Core MySQL 提供程序
    - 创建 DbContext 基类
    - 配置数据库连接字符串
    - _需求: 数据存储层_
  - [x] 1.3 配置 Redis 缓存服务
    - 安装 StackExchange.Redis
    - 创建缓存服务接口和实现
    - _需求: 缓存策略_

- [x] 2. 搭建前端项目结构
  - [x] 2.1 创建 React + TypeScript 项目
    - 使用 Vite 创建项目
    - 配置 TypeScript 和 ESLint
    - 安装 Ant Design 组件库
    - _需求: 17.1, 17.3_
  - [x] 2.2 配置前端项目结构
    - 创建 components、pages、services、store、utils 目录
    - 配置路由 (React Router)
    - 配置状态管理 (Zustand/Redux)
    - _需求: 前端组件结构_

- [x] 3. 检查点 - 项目基础设施验证
  - 确保后端项目可以编译运行
  - 确保前端项目可以启动
  - 确保数据库连接正常
  - 如有问题请咨询用户

---

### 阶段 2: 数据模型和数据库

- [x] 4. 创建数据库实体模型
  - [x] 4.1 创建员工相关实体
    - Employee 实体类
    - Address 收货地址实体类
    - _需求: 1.7, 6.1_
  - [x] 4.2 创建产品相关实体
    - Product 实体类
    - ProductImage 实体类
    - ProductTag 实体类
    - _需求: 2.3, 2.4, 2.6_
  - [x] 4.3 创建订单相关实体
    - Order 实体类
    - OrderItem 实体类
    - ShoppingCart 实体类
    - _需求: 5.7, 5.8, 4.1_
  - [x] 4.4 创建积分相关实体
    - PointsTransaction 实体类
    - _需求: 3.10_
  - [x] 4.5 创建管理员和系统实体
    - Administrator 实体类
    - Notification 实体类
    - AuditLog 实体类
    - _需求: 8.1, 14.1, 13.1_
  - [x] 4.6 编写数据模型属性测试
    - **属性 21: 外键引用完整性**
    - **属性 22: 唯一性约束**
    - **属性 23: 枚举值约束**
    - **验证: 数据库约束, 需求 1.7, 2.6**

- [x] 5. 创建数据库迁移和种子数据
  - [x] 5.1 创建 EF Core 迁移
    - 配置实体关系映射
    - 创建初始迁移
    - _需求: 数据模型设计_
  - [x] 5.2 创建种子数据
    - 创建测试用管理员账号
    - 创建测试用产品数据
    - _需求: 测试数据_

- [x] 6. 检查点 - 数据库验证
  - 确保所有迁移成功执行
  - 确保种子数据正确插入
  - 如有问题请咨询用户

---

### 阶段 3: 认证与授权模块

- [x] 7. 实现认证服务
  - [x] 7.1 实现密码加密服务
    - 使用 BCrypt 实现密码哈希
    - 创建 IPasswordService 接口和实现
    - _需求: 1.5, 15.2_
  - [x] 7.2 编写密码加密属性测试
    - **属性 13: 密码加密存储**
    - **验证: 需求 1.5**
  - [x] 7.3 实现 JWT Token 服务
    - 创建 Token 生成和验证逻辑
    - 配置 Token 有效期 (2小时)
    - _需求: 1.3, 15.6_
  - [x] 7.4 编写会话有效期属性测试
    - **属性 14: 会话有效期**
    - **验证: 需求 1.3, 1.4**

- [x] 8. 实现员工认证 API
  - [x] 8.1 实现员工登录接口
    - POST /api/auth/employee/login
    - 验证邮箱和密码
    - 返回 JWT Token
    - _需求: 1.1, 1.2_
  - [x] 8.2 实现员工信息接口
    - GET /api/employees/me
    - 返回当前登录员工信息（脱敏）
    - _需求: 1.8_

- [x] 9. 实现管理员认证 API
  - [x] 9.1 实现管理员登录接口
    - POST /api/auth/admin/login
    - 验证账号和密码
    - 返回 JWT Token 和角色信息
    - _需求: 8.2_
  - [x] 9.2 实现 RBAC 权限中间件
    - 创建角色权限验证中间件
    - 配置三种管理员角色权限
    - _需求: 8.3, 8.4, 8.5, 8.6, 8.7, 8.8_
  - [x] 9.3 编写权限控制属性测试
    - **属性 15: 权限控制正确性**
    - **验证: 需求 8.6, 8.7, 8.8**

- [x] 10. 实现前端认证模块
  - [x] 10.1 创建登录页面组件
    - 员工登录页面
    - 管理员登录页面
    - _需求: 1.1, 8.2_
  - [x] 10.2 实现认证状态管理
    - Token 存储和刷新
    - 登录状态持久化
    - _需求: 1.3, 1.6_
  - [x] 10.3 实现路由守卫
    - 未登录重定向
    - 权限不足提示
    - _需求: 8.8_

- [x] 11. 检查点 - 认证模块验证
  - 确保员工和管理员可以正常登录
  - 确保 Token 验证正常工作
  - 确保权限控制正确
  - 如有问题请咨询用户

---

### 阶段 4: 积分系统模块

- [x] 12. 实现积分服务核心逻辑
  - [x] 12.1 实现积分余额管理
    - 创建 IPointsService 接口
    - 实现积分余额查询
    - 实现积分余额非负约束
    - _需求: 3.1, 3.2, 3.3_
  - [x] 12.2 编写积分余额非负属性测试
    - **属性 1: 积分余额非负不变量**
    - **验证: 需求 3.2**
  - [x] 12.3 实现积分交易记录
    - 创建积分交易记录逻辑
    - 记录所有必需字段
    - _需求: 3.10_
  - [x] 12.4 编写积分交易记录属性测试
    - **属性 2: 积分交易记录完整性**
    - **验证: 需求 3.10**

- [x] 13. 实现积分发放和扣除
  - [x] 13.1 实现手动积分发放
    - POST /api/admin/points/grant
    - 支持单个和批量发放
    - _需求: 3.8, 10.3, 10.6_
  - [x] 13.2 编写批量操作原子性属性测试
    - **属性 20: 批量操作原子性**
    - **验证: 需求 10.6**
  - [x] 13.3 实现积分扣除
    - POST /api/admin/points/deduct
    - 验证余额充足
    - _需求: 3.9, 10.4_

- [x] 14. 实现积分自动发放任务
  - [x] 14.1 实现每月自动发放
    - 创建定时任务服务
    - 每月1号发放500积分
    - _需求: 3.5_
  - [x] 14.2 实现入职积分发放
    - 新员工入职发放1000积分
    - _需求: 3.6_
  - [x] 14.3 实现生日积分发放
    - 生日当天发放200积分
    - _需求: 3.7_

- [x] 15. 实现积分过期处理
  - [x] 15.1 实现积分过期检查任务
    - 检查超过1年的积分
    - 标记为过期并扣除
    - _需求: 3.4_
  - [x] 15.2 编写积分过期属性测试
    - **属性 10: 积分过期正确性**
    - **验证: 需求 3.4**

- [x] 16. 实现积分 API 接口
  - [x] 16.1 实现积分余额查询接口
    - GET /api/points/balance
    - 返回余额和即将过期积分
    - _需求: 3.3_
  - [x] 16.2 实现积分历史查询接口
    - GET /api/points/transactions
    - 支持分页和时间筛选
    - _需求: 3.11_
  - [x] 16.3 实现积分历史导出接口
    - GET /api/points/transactions/export
    - 生成 Excel/CSV 文件
    - _需求: 3.12_

- [x] 17. 实现前端积分模块
  - [x] 17.1 创建积分余额显示组件
    - 在页面显著位置显示余额
    - _需求: 3.3_
  - [x] 17.2 创建积分历史页面
    - 显示积分交易记录列表
    - 支持筛选和导出
    - _需求: 3.11, 3.12_
  - [x] 17.3 创建管理员积分管理页面
    - 员工列表和搜索
    - 积分发放和扣除表单
    - _需求: 10.1, 10.2, 10.3, 10.4, 10.5_

- [x] 18. 检查点 - 积分模块验证
  - 确保积分发放和扣除正常工作
  - 确保积分余额计算正确
  - 确保所有属性测试通过
  - 如有问题请咨询用户

---

### 阶段 5: 产品管理模块

- [x] 19. 实现产品服务核心逻辑
  - [x] 19.1 实现产品 CRUD 服务
    - 创建 IProductService 接口
    - 实现产品增删改查
    - _需求: 9.1, 9.2, 9.3_
  - [x] 19.2 实现产品上下架逻辑
    - 上架/下架状态切换
    - 下架产品对员工不可见
    - _需求: 9.4, 9.5_
  - [x] 19.3 实现产品图片上传
    - 集成对象存储服务
    - 支持多图片上传
    - _需求: 9.6_

- [x] 20. 实现产品搜索和筛选
  - [x] 20.1 实现产品搜索服务
    - 全文搜索产品名称和描述
    - _需求: 2.8_
  - [x] 20.2 编写搜索结果属性测试
    - **属性 11: 搜索结果相关性**
    - **验证: 需求 2.8**
  - [x] 20.3 实现产品分类筛选
    - 按分类筛选产品
    - _需求: 2.7_
  - [x] 20.4 编写分类筛选属性测试
    - **属性 12: 分类筛选正确性**
    - **验证: 需求 2.7**
  - [x] 20.5 实现产品综合筛选
    - 支持分类、积分范围、库存状态筛选
    - _需求: 2.9_

- [x] 21. 实现产品 API 接口
  - [x] 21.1 实现产品列表接口
    - GET /api/products
    - 支持分页、搜索、筛选
    - _需求: 2.1, 2.7, 2.8, 2.9_
  - [x] 21.2 实现产品详情接口
    - GET /api/products/{id}
    - 返回完整产品信息
    - _需求: 2.5_
  - [x] 21.3 实现管理员产品接口
    - POST /api/admin/products
    - PUT /api/admin/products/{id}
    - DELETE /api/admin/products/{id}
    - _需求: 9.1, 9.2, 9.3_

- [x] 22. 实现前端产品模块
  - [x] 22.1 创建产品列表页面
    - 产品卡片展示
    - 搜索和筛选功能
    - _需求: 2.1, 2.7, 2.8, 2.9_
  - [x] 22.2 创建产品详情页面
    - 图片轮播展示
    - 产品信息展示
    - _需求: 2.3, 2.4, 2.5_
  - [x] 22.3 创建管理员产品管理页面
    - 产品列表和搜索
    - 产品编辑表单
    - 图片上传组件
    - _需求: 9.1, 9.6, 9.7, 9.8_

- [x] 23. 检查点 - 产品模块验证
  - 确保产品 CRUD 正常工作
  - 确保搜索和筛选正确
  - 确保所有属性测试通过
  - 如有问题请咨询用户

---

### 阶段 6: 购物车模块

- [x] 24. 实现购物车服务
  - [x] 24.1 实现购物车核心逻辑
    - 创建 IShoppingCartService 接口
    - 实现添加、修改、删除商品
    - _需求: 4.1, 4.4, 4.5_
  - [x] 24.2 实现购物车总积分计算
    - 计算购物车总积分
    - 实时更新总积分
    - _需求: 4.3, 4.4_
  - [x] 24.3 编写购物车总积分属性测试
    - **属性 3: 购物车总积分计算正确性**
    - **验证: 需求 4.3**
  - [x] 24.4 实现库存检查逻辑
    - 禁止添加缺货商品
    - 标记缺货商品
    - _需求: 4.2, 4.6_

- [x] 25. 实现购物车 API 接口
  - [x] 25.1 实现购物车接口
    - GET /api/cart
    - POST /api/cart/items
    - PUT /api/cart/items/{id}
    - DELETE /api/cart/items/{id}
    - _需求: 4.1, 4.3, 4.4, 4.5_

- [x] 26. 实现前端购物车模块
  - [x] 26.1 创建购物车组件
    - 购物车列表展示
    - 数量修改和删除
    - 总积分显示
    - _需求: 4.3, 4.4, 4.5_
  - [x] 26.2 创建加入购物车功能
    - 产品页面添加按钮
    - 缺货状态处理
    - _需求: 4.1, 4.2_

- [x] 27. 检查点 - 购物车模块验证
  - 确保购物车功能正常工作
  - 确保总积分计算正确
  - 确保所有属性测试通过
  - 如有问题请咨询用户

---

### 阶段 7: 订单与兑换模块

- [ ] 28. 实现收货地址服务
  - [ ] 28.1 实现地址 CRUD 服务
    - 创建 IAddressService 接口
    - 实现地址增删改查
    - _需求: 6.1, 6.2, 6.3_
  - [ ] 28.2 实现默认地址逻辑
    - 设置默认地址
    - 确保只有一个默认地址
    - _需求: 6.4_
  - [ ] 28.3 编写默认地址属性测试
    - **属性 17: 地址默认唯一性**
    - **验证: 需求 6.4**

- [ ] 29. 实现订单服务核心逻辑
  - [ ] 29.1 实现订单创建服务
    - 创建 IOrderService 接口
    - 实现订单创建逻辑
    - _需求: 5.2, 5.7_
  - [ ] 29.2 实现兑换事务管理
    - 积分扣除、订单创建、库存减少原子操作
    - 失败回滚机制
    - _需求: 5.2_
  - [ ] 29.3 编写兑换事务原子性属性测试
    - **属性 4: 兑换事务原子性**
    - **验证: 需求 5.2**
  - [ ] 29.4 实现兑换幂等性控制
    - 防止重复提交
    - 验证码验证
    - _需求: 5.5, 5.6_
  - [ ] 29.5 编写兑换幂等性属性测试
    - **属性 5: 兑换幂等性**
    - **验证: 需求 5.5**

- [ ] 30. 实现兑换规则验证
  - [ ] 30.1 实现积分余额验证
    - 检查积分是否充足
    - _需求: 5.3_
  - [ ] 30.2 实现每月兑换次数限制
    - 检查当月兑换次数
    - 限制每月5次
    - _需求: 5.9_
  - [ ] 30.3 编写每月兑换次数属性测试
    - **属性 7: 每月兑换次数限制**
    - **验证: 需求 5.9**
  - [ ] 30.4 实现重复兑换限制
    - 检查是否已兑换过该产品
    - _需求: 5.10_
  - [ ] 30.5 编写重复兑换属性测试
    - **属性 8: 产品重复兑换限制**
    - **验证: 需求 5.10**

- [ ] 31. 实现订单取消功能
  - [ ] 31.1 实现订单取消逻辑
    - 验证取消条件（24小时内、待发货状态）
    - 退回积分、恢复库存
    - _需求: 5.11, 5.12, 5.13_
  - [ ] 31.2 编写取消兑换回滚属性测试
    - **属性 6: 取消兑换回滚正确性**
    - **验证: 需求 5.12, 5.13**
  - [ ] 31.3 编写库存一致性属性测试
    - **属性 9: 库存一致性**
    - **验证: 需求 5.2, 5.13**

- [ ] 32. 实现订单状态管理
  - [ ] 32.1 实现订单状态转换
    - 状态机：待确认 → 待发货 → 已发货 → 已完成
    - 任意状态 → 已取消
    - _需求: 5.8_
  - [ ] 32.2 编写订单状态转换属性测试
    - **属性 16: 订单状态转换合法性**
    - **验证: 需求 5.8**

- [ ] 33. 实现订单 API 接口
  - [ ] 33.1 实现员工订单接口
    - POST /api/orders (创建订单)
    - GET /api/orders (订单列表)
    - GET /api/orders/{id} (订单详情)
    - PUT /api/orders/{id}/cancel (取消订单)
    - _需求: 5.1, 5.2, 5.11, 7.1, 7.5_
  - [ ] 33.2 实现管理员订单接口
    - GET /api/admin/orders
    - PUT /api/admin/orders/{id}/status
    - _需求: 11.1, 11.5, 11.6_
  - [ ] 33.3 实现地址接口
    - GET /api/addresses
    - POST /api/addresses
    - PUT /api/addresses/{id}
    - DELETE /api/addresses/{id}
    - _需求: 6.1, 6.2, 6.3, 6.5_

- [ ] 34. 实现前端订单模块
  - [ ] 34.1 创建兑换确认页面
    - 产品信息展示
    - 地址选择
    - 验证码输入
    - _需求: 5.1, 5.4, 5.6_
  - [ ] 34.2 创建订单历史页面
    - 订单列表展示
    - 筛选和搜索
    - _需求: 7.1, 7.2, 7.3_
  - [ ] 34.3 创建订单详情页面
    - 订单信息展示
    - 物流信息展示
    - 取消订单功能
    - _需求: 7.5, 5.11_
  - [ ] 34.4 创建收货地址管理页面
    - 地址列表
    - 地址编辑表单
    - _需求: 6.1, 6.2, 6.3, 6.4, 6.5_
  - [ ] 34.5 创建管理员订单管理页面
    - 订单列表和搜索
    - 订单状态修改
    - 物流信息填写
    - _需求: 11.1, 11.2, 11.3, 11.4, 11.5, 11.6_

- [ ] 35. 检查点 - 订单模块验证
  - 确保兑换流程正常工作
  - 确保订单状态转换正确
  - 确保所有属性测试通过
  - 如有问题请咨询用户

---

### 阶段 8: 通知与日志模块

- [ ] 36. 实现通知服务
  - [ ] 36.1 实现通知核心逻辑
    - 创建 INotificationService 接口
    - 实现通知创建和查询
    - _需求: 14.1, 14.2, 14.3_
  - [ ] 36.2 编写通知触发属性测试
    - **属性 18: 通知触发完整性**
    - **验证: 需求 14.1, 14.2**
  - [ ] 36.3 实现通知已读状态管理
    - 标记已读
    - 未读数量统计
    - _需求: 14.4, 14.5, 14.6_

- [ ] 37. 实现操作日志服务
  - [ ] 37.1 实现审计日志核心逻辑
    - 创建 IAuditLogService 接口
    - 记录管理员操作
    - _需求: 13.1_
  - [ ] 37.2 编写操作日志属性测试
    - **属性 19: 操作日志记录完整性**
    - **验证: 需求 13.1**
  - [ ] 37.3 实现日志查询和导出
    - 支持搜索和筛选
    - 支持导出
    - _需求: 13.2, 13.3, 13.4, 13.5_

- [ ] 38. 实现通知和日志 API 接口
  - [ ] 38.1 实现通知接口
    - GET /api/notifications
    - PUT /api/notifications/{id}/read
    - _需求: 14.4, 14.5, 14.6_
  - [ ] 38.2 实现审计日志接口
    - GET /api/admin/audit-logs
    - GET /api/admin/audit-logs/export
    - _需求: 13.2, 13.3, 13.4, 13.5_

- [ ] 39. 实现前端通知和日志模块
  - [ ] 39.1 创建通知组件
    - 通知图标和未读数量
    - 通知列表下拉
    - _需求: 14.4, 14.5_
  - [ ] 39.2 创建审计日志页面
    - 日志列表和搜索
    - 日志导出
    - _需求: 13.2, 13.3, 13.4, 13.5_

- [ ] 40. 检查点 - 通知和日志模块验证
  - 确保通知功能正常工作
  - 确保审计日志记录完整
  - 确保所有属性测试通过
  - 如有问题请咨询用户

---

### 阶段 9: 统计报表模块

- [ ] 41. 实现统计服务
  - [ ] 41.1 实现基础统计逻辑
    - 总兑换量、总积分发放量
    - 总员工数、总产品数
    - _需求: 12.1_
  - [ ] 41.2 实现产品统计
    - 产品兑换次数排名
    - _需求: 12.2_
  - [ ] 41.3 实现积分统计
    - 积分发放和消耗趋势
    - _需求: 12.3_
  - [ ] 41.4 实现员工统计
    - 活跃员工排名
    - _需求: 12.4_

- [ ] 42. 实现统计 API 接口
  - [ ] 42.1 实现统计接口
    - GET /api/admin/statistics/overview
    - GET /api/admin/statistics/products
    - GET /api/admin/statistics/points
    - GET /api/admin/statistics/employees
    - _需求: 12.1, 12.2, 12.3, 12.4, 12.5_
  - [ ] 42.2 实现报表导出接口
    - GET /api/admin/statistics/export
    - _需求: 12.6_

- [ ] 43. 实现前端统计模块
  - [ ] 43.1 创建统计仪表盘页面
    - 概览数据卡片
    - 趋势图表
    - 排名列表
    - _需求: 12.1, 12.2, 12.3, 12.4_
  - [ ] 43.2 实现时间范围筛选
    - 日期选择器
    - 数据刷新
    - _需求: 12.5_

- [ ] 44. 检查点 - 统计模块验证
  - 确保统计数据准确
  - 确保图表展示正确
  - 如有问题请咨询用户

---

### 阶段 10: 安全与性能优化

- [x] 45. 实现安全防护
  - [x] 45.1 配置 HTTPS
    - SSL 证书配置
    - 强制 HTTPS 重定向
    - _需求: 15.1_
  - [x] 45.2 实现防重复提交
    - 请求签名验证
    - 时间戳验证
    - _需求: 15.4_
  - [x] 45.3 实现验证码服务
    - 图形验证码生成
    - 验证码验证
    - _需求: 15.5_
  - [x] 45.4 实现会话超时管理
    - 30分钟无操作自动退出
    - _需求: 15.7_

- [x] 46. 实现并发控制
  - [x] 46.1 实现库存并发控制
    - 乐观锁/悲观锁
    - 防止超卖
    - _需求: 5.2_
  - [x] 46.2 编写并发安全性属性测试
    - **属性 25: 并发安全性**
    - **验证: 需求 5.2**

- [x] 47. 实现性能优化
  - [x] 47.1 实现 Redis 缓存
    - 产品列表缓存
    - 热点数据缓存
    - _需求: 16.1, 16.2_
  - [x] 47.2 实现 API 限流
    - 每 IP 每分钟请求限制
    - _需求: 安全设计_
  - [x] 47.3 实现数据库查询优化
    - 索引优化
    - 查询优化
    - _需求: 16.3, 16.4, 16.5_

- [x] 48. 检查点 - 安全与性能验证
  - 确保安全防护正常工作
  - 确保并发控制正确
  - 确保性能满足要求
  - 如有问题请咨询用户

---

### 阶段 11: 响应式设计与兼容性

- [x] 49. 实现响应式布局
  - [x] 49.1 实现移动端适配
    - 响应式布局组件
    - 移动端导航
    - _需求: 17.2, 17.5_
  - [x] 49.2 实现亚马逊风格界面
    - 整体视觉风格
    - 组件样式调整
    - _需求: 17.4_

- [ ] 50. 实现浏览器兼容性
  - [ ] 50.1 测试主流浏览器兼容性
    - Chrome、Safari、Firefox、Edge
    - _需求: 17.3_

- [ ] 51. 检查点 - UI/UX 验证
  - 确保响应式布局正常
  - 确保浏览器兼容性
  - 如有问题请咨询用户

---

### 阶段 12: 集成测试与部署

- [ ] 52. 实现集成测试
  - [ ] 52.1 编写 API 集成测试
    - 认证流程测试
    - 兑换流程测试
    - _需求: 测试策略_
  - [ ] 52.2 编写端到端测试
    - 员工完整兑换流程
    - 管理员完整管理流程
    - _需求: 测试策略_

- [ ] 53. 配置部署环境
  - [ ] 53.1 创建 Docker 配置
    - Dockerfile
    - docker-compose.yml
    - _需求: 部署架构_
  - [ ] 53.2 配置 CI/CD 流水线
    - GitHub Actions 配置
    - 自动化测试和部署
    - _需求: 持续集成_

- [ ] 54. 最终检查点 - 系统验收
  - 确保所有功能正常工作
  - 确保所有测试通过
  - 确保部署配置正确
  - 准备上线

---

## 备注

- 每个检查点都是验证阶段成果的关键节点
- 属性测试使用 CsCheck 或 FsCheck 库实现
- 每个属性测试至少运行 100 次迭代
- 所有属性测试都标注了对应的设计文档属性编号和需求编号
- 所有任务（包括属性测试）均为必需任务，确保系统正确性
